import{n as _}from"./chunk-ZQUYSZ2R.js";import{Ab as x,Bb as w,Cb as b,Db as d,Hb as u,Mb as M,Nb as k,Ob as E,Tb as r,Va as v,Wa as C,gb as c,ya as y}from"./chunk-WFVCX3BK.js";var A=["engineCanvas"],o=class o{constructor(){this.speed=1;this.state="paused";this.scale=1;this.offsetX=0;this.offsetY=0;this.minScale=1;this.maxScale=128;this.isPanning=!1;this.lastX=0;this.lastY=0}onWheel(e){e.preventDefault();let{offsetX:t,offsetY:s}=e,i=t/this.scale+this.offsetX,n=s/this.scale+this.offsetY,p=e.deltaY<0?1.15:1/1.15;this.scale=Math.min(this.maxScale,Math.max(this.minScale,this.scale*p)),this.offsetX=i-t/this.scale,this.offsetY=n-s/this.scale,this.sendCamera()}onDown(e){e.button===2?(this.isPanning=!0,this.lastX=e.clientX,this.lastY=e.clientY):e.button===0&&this.drawAt(e)}onMove(e){if(this.isPanning){let t=e.clientX-this.lastX,s=e.clientY-this.lastY;this.lastX=e.clientX,this.lastY=e.clientY,this.offsetX=(this.offsetX-t/this.scale+this.ruleset.cols)%this.ruleset.cols,this.offsetY=(this.offsetY+s/this.scale+this.ruleset.rows)%this.ruleset.rows,this.sendCamera()}else e.buttons&1&&this.drawAt(e)}onUp(){this.isPanning=!1}disableCtx(e){e.preventDefault()}resizeCanvas(){let e=window.innerWidth,t=window.innerHeight;if(this.offscreen){let s=window.devicePixelRatio||1;this.offscreen.width=e*s,this.offscreen.height=t*s,this.worker.postMessage({type:"resize",width:this.offscreen.width,height:this.offscreen.height,dpr:s})}else{let s=this.canvasRef.nativeElement;s.width=e,s.height=t}this.ruleset&&(this.minScale=Math.min(e/this.ruleset.cols,t/this.ruleset.rows))}ngAfterViewInit(){this.resizeCanvas(),this.offscreen=this.canvasRef.nativeElement.transferControlToOffscreen(),this.worker=new Worker(new URL("worker-H5SPJWJN.js",import.meta.url),{type:"module"}),this.worker.postMessage({type:"init",canvas:this.offscreen,ruleset:this.ruleset,speed:this.speed,running:this.state==="running"},[this.offscreen]),this.worker.postMessage({type:"setRunning",running:this.state==="running"}),this.worker.postMessage({type:"setSpeed",speed:this.speed}),this.worker.postMessage({type:"setRuleset",ruleset:this.ruleset}),this.resetCamera(),this.worker.onmessage=e=>{}}ngOnChanges(e){if(this.worker&&(e.state&&this.worker.postMessage({type:"setRunning",running:this.state==="running"}),e.speed&&this.worker.postMessage({type:"setSpeed",speed:this.speed}),e.ruleset)){let t=!e.ruleset.previousValue||e.ruleset.previousValue.rows!==this.ruleset.rows||e.ruleset.previousValue.cols!==this.ruleset.cols;this.worker.postMessage({type:"setRuleset",ruleset:this.ruleset}),t&&this.resetCamera()}}ngOnDestroy(){this.worker?.terminate()}resetCamera(){let e=window.innerWidth,t=window.innerHeight;this.minScale=Math.max(e/this.ruleset.cols,t/this.ruleset.rows),this.scale=this.minScale,this.offsetX=0,this.offsetY=0,this.sendCamera()}sendCamera(){this.worker?.postMessage({type:"camera",scale:this.scale,offsetX:this.offsetX,offsetY:this.offsetY})}drawAt(e){let t=this.canvasRef.nativeElement.getBoundingClientRect(),s=e.clientX-t.left,i=e.clientY-t.top,n=0,p=window.innerHeight-this.ruleset.rows*this.scale,H=(s-n)/this.scale+this.offsetX,Y=(i-p)/this.scale-this.offsetY,l=Math.ceil(1/this.scale),D=Math.floor(H)-Math.floor(l/2),P=Math.floor(Y)-Math.floor(l/2),T=[];for(let g=0;g<l;g++)for(let m=0;m<l;m++)T.push({x:D+m,y:this.ruleset.rows-1-P+g});this.worker?.postMessage({type:"draw",tribe:this.drawTribe,cells:T})}};o.\u0275fac=function(t){return new(t||o)},o.\u0275cmp=c({type:o,selectors:[["gol-engine"]],viewQuery:function(t,s){if(t&1&&M(A,7),t&2){let i;k(i=E())&&(s.canvasRef=i.first)}},hostBindings:function(t,s){t&1&&u("wheel",function(n){return s.onWheel(n)})("mousedown",function(n){return s.onDown(n)})("mousemove",function(n){return s.onMove(n)})("mouseup",function(){return s.onUp()})("contextmenu",function(n){return s.disableCtx(n)})("resize",function(){return s.resizeCanvas()},v)},inputs:{ruleset:"ruleset",speed:"speed",state:"state",drawTribe:"drawTribe"},features:[y],decls:3,vars:0,consts:[["engineCanvas",""],["tabindex","-1"]],template:function(t,s){t&1&&(d(0,"canvas",1,0),r(2,`
`))},styles:["[_nghost-%COMP%]{display:block;width:100vw;height:100vh;overflow:hidden}[_nghost-%COMP%]   canvas[_ngcontent-%COMP%]{width:100%;height:100%;display:block}"],changeDetection:0});var h=o;var f={id:"dead",color:"000000"};var I=[f,{id:"classic",color:"f0f0f0"}],a=class a{constructor(){this.ruleset={cols:100,rows:100,tribes:I,rules:[{clause:{kind:"and",clauses:[{kind:"is",tribes:["classic"]},{kind:"count",interval:[0,1],tribes:["classic"]}]},tribe:f.id},{clause:{kind:"and",clauses:[{kind:"is",tribes:["classic"]},{kind:"count",interval:[2,3],tribes:["classic"]}]},tribe:"classic"},{clause:{kind:"and",clauses:[{kind:"is",tribes:["classic"]},{kind:"count",interval:[4,8],tribes:["classic"]}]},tribe:f.id},{clause:{kind:"and",clauses:[{kind:"is",tribes:["dead"]},{kind:"count",interval:[3,3],tribes:["classic"]}]},tribe:"classic"}]};this.state="paused"}test(e){e.key===" "&&(this.state==="paused"?this.state="running":this.state="paused")}onMetrics(e){console.log(e)}};a.\u0275fac=function(t){return new(t||a)},a.\u0275cmp=c({type:a,selectors:[["gol-home"]],hostBindings:function(t,s){t&1&&u("keydown",function(n){return s.test(n)})},decls:8,vars:4,consts:[[3,"drawTribe","ruleset","speed","state"]],template:function(t,s){t&1&&(w(0,"section"),r(1,"WIP"),b(),r(2,`
`),w(3,"section"),r(4,`
  `),d(5,"gol-engine",0),r(6,`
`),b(),r(7,`
`)),t&2&&(C(5),x("drawTribe","classic")("ruleset",s.ruleset)("speed",1)("state",s.state))},dependencies:[_,h],styles:["[_nghost-%COMP%]{color:#fff;display:flex;width:100%}[_nghost-%COMP%] > section[_ngcontent-%COMP%]:first-child{width:20%;display:none}[_nghost-%COMP%] > section[_ngcontent-%COMP%]{width:100%}[_nghost-%COMP%] > section[_ngcontent-%COMP%] > canvas[_ngcontent-%COMP%]{display:block;width:100%;height:100%;border:1px solid whitesmoke}"]});var R=a;export{R as HomePage};
